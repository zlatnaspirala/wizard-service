<!DOCTYPE html>
<html>
  <head>
    <title>Wizard Remote Desktop - Control Page</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="holder">
     Wizard Remote Desktop 1.0 WebClient
     <button> CLICK</button>
     <textarea> </textarea>
     <div id="output"></div>
    </div>
    <canvas id="video-canvas"></canvas>
    <script type="text/javascript" src="jsmpeg.min.js"></script>
    <script defer type="text/javascript" src="controller.js"></script>
    <script type="text/javascript">
      var instanceId = location.href.split("wizard-")[1].split('.ht')[0];

      console.log("Welcome to the Wizard Remote Desktop - Client part -> ");
      console.log("Hello there. My instance id is -> ", instanceId);

      window.addEventListener("load", function () {
        initCoordinator(instanceId);
      }, false);

      console.info("----------------------------------");
      console.info("- WIZARD REMOTE DESKTOP WEB PART -");
      console.info("- Hosted on:                     -");
      console.info("- https://maximumroulette.com    -");
      console.info("----------------------------------");
      var initialRun = true,
        justOnce = true,
        canvas = null,
        url = null,
        player = null;

      function runStream() {
        var wsProtocol = 'ws';
        if (window.location.protocol.indexOf("https") != -1) {
          wsProtocol = 'wss';
        }
        canvas = document.getElementById("video-canvas");
        url = wsProtocol + "://" + document.location.hostname + ":8082/" + instanceId;
        player = new JSMpeg.Player(url, {canvas: canvas});
        player.source.shouldAttemptReconnect = false;
        player.source.reconnectInterval = 10000;

        setTimeout(function() {
          player.source.shouldAttemptReconnect = false;
        }, 500)

        setTimeout(function() {
          if (player.isPlaying == false) {
            console.info("After 3 secound no connection ...");
          }
        }, 3000);
        window.removeEventListener("click", runStream, false);
      }

      if (initialRun) {
        runStream();
      } else {
        window.addEventListener("click", runStream, false);
      }
    </script>
  </body>
</html>
