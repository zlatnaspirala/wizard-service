<!DOCTYPE html>
<html>
  <head>
    <title>Wizard Remote Control</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="holder">
     Wizard 1.0 Client part
     <button> CLICK</button>
     <textarea> </textarea>
     <div id="output"></div>
    </div>
    <canvas id="video-canvas"></canvas>
    <script type="text/javascript" src="jsmpeg.min.js"></script>
    <script defer type="text/javascript" src="controller.js"></script>
    <script type="text/javascript">
      var instanceId = location.href.split("wizard-")[1].split('.ht')[0];

      console.log("Welcome to the Wizard Remote Desktop - Client part -> ");
      console.log("Hello there. My instance id is -> ", instanceId);

      window.addEventListener("load", function () {
        initCoordinator(instanceId);
      }, false);

      console.log("---------------------------------");
      console.log("- WIZARD REMOTE DESKTOP WEB PART -");
      console.log("---------------------------------");
      var initialRun = true,
        justOnce = true,
        canvas = null,
        url = null,
        player = null;

      function runStream() {
        var wsProtocol = 'ws';
        if (window.location.protocol.indexOf("https") != -1) {
          // wsProtocol = 'wss';
        }
        canvas = document.getElementById("video-canvas");
        url = wsProtocol + "://" + document.location.hostname + ":8082/" + instanceId;
        player = new JSMpeg.Player(url, {canvas: canvas});
        player.source.shouldAttemptReconnect = false;
        player.source.reconnectInterval = 10000;
        // player.source.abort()

        window.removeEventListener("click", runStream, false);
      }

      if (initialRun) {
        runStream();
      } else {
        window.addEventListener("click", runStream, false);
      }
    </script>
  </body>
</html>
